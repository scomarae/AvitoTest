# AvitoTest
Тестовое задание Лобашевой Ольги Андреевны, срок выполнения: 4 дня



Проект представляет собой HTTP API на языке Go - микросервис для работы с балансом пользователей.
Реализованы функции начисления баланса ползователю, резервирования баланса на отдельном счете, подтверждения транзакции и отправки платежа в отчет.


Основной файл main.go принимает данные в формате JSON и отправляет ответ на сервер в таком же формате.

Файл creating.sql представляет собой конечный SQL-запрос для создания базы данных со всеми нужными таблицами.

Файл structs.go содержит структуры данных, получаемых и отправляемых в формате JSON.

Функции файла balanceDb.go работают с данными в базе данных SQL. Подробнее о них:

GetBalance получает баланс пользователя из таблицы balance базы данных по его id.

AccrualMoneyToBalance начисляет деньги на баланс пользователя в таблице balance. Если пользователя еще нет в системе, функция создает его с балансом, равным сумме текущего начисления.

ReserveBalance снимает деньги с баланса клиента, если на балансе достаточное количество денег для проведения операции, и резервирует их на отдельном счете (таблица reserve).

ConfirmTransaction подтверждает транзакцию - удаляет резервирование и добавляет данные о платеже в отчет для бухгалтерии (папка report в базе данных).

Инструкция по запуску приложения:
В командной строке (убедиться, что задан путь к расположению директории с проектом) выполнить команду "go build main.go", затем выполинть команду "go run main.go". Приложение запущено и готово принимать запросы в JSON-формате.

Примеры запросов и ответов (POSTMAN, скриншоты прилагаются в директории screens)

Запрос на начисление баланса несуществующему пользователю: POST http://localhost:8083/balance {"user_id": "222842","amount": 5000000 }
Ответ: { "user_id": "222842", "amount": 5000000 }, данные добавлены в базу в таблицу balance.

Запрос на начисление баланса существующему пользователю: POST http://localhost:8083/balance {"user_id": "222842","amount": 3 }
Ответ: { "user_id": "222842", "amount": 3 }, данные обновлены в базе в таблице balance.

Запрос на получение баланса пользователя по id: GET http://localhost:8083/balance/222842
Ответ: { "user_id": "222842", "balance": 5000003 }

Запрос на резервирование денег с баланса пользователя: POST http://localhost:8083/reserve {"user_id": "222842","service_id": "1", "purchase_id":"1", "price": 4 }
Ответ: { "user_id": "222842", "service_id": "1", "purchase_id": "1", "price": 4 }, баланс пользователя в таблице balance уменьшен на нужную сумму, в таблице reserve новая запись.

Запрос на подтверждение транзакции: POST http://localhost:8083/reserve {"user_id": "222842","service_id": "1", "purchase_id":"1", "price": 4 }
Ответ: { "user_id": "222842", "service_id": "1", "purchase_id": "1", "price": 4 }, запись о платеже добавлена в бухгалтерский отчет (таблица report), резерв удален из таблицы reserve

Вопросы по ТЗ, возникшие во время выполнения задания:

На чей стороне проверяется, есть ли в системе пользователь, пополнивший баланс?
Мое решение: функция AccrualMoneyToBalance проверяет, есть ли пользователь в базе данных, и если нет - создает его. Если пользователь существует - изменяет значение баланса.